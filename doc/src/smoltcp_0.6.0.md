# smoltcp

[オリジナル](https://crates.io/crates/smoltcp/0.6.0)

**smoltcp**はベアメタル、リアルタイムシステム用に設計された、スタンドアロンで
イベント駆動型のTCP/IPスタックです。その設計目標はシンプルさと堅牢性です。
その設計上のアンチゴールは、たとえパフォーマンスの低下を犠牲になっても、
マクロや型トリックなどのコンパイル時の複雑な計算です。

**smoltcp**はヒープ割り当てを _まったく_ 必要とせず、[広範なドキュメント](https://docs.rs/smoltcp/)が
あり、Rust 1.28安定版以降でコンパイルできます。

**smoltcp**はループバックモードでLinux TCPスタックに対してテストしたところ、
~Gbpsのスループットを達成しました。

## 機能

**smoltcp**には広く展開されている多くの機能が欠けています。通常、その理由は
まだ誰も実装していないからです。期待値を正しく設定するために、実装されている
機能と省略されている機能を以下にリストアップします。

### メディア層

サポートされるメディアはイーサネットだけです。

- 通常のイーサネットIIフレームがサポートされています。
- ユニキャスト、ブロードキャスト、マルチキャストパケットがサポートされています。
- ARPパケット（gratuitousリクエストとリプライを含む）がサポートされています。
- ARPリクエストは1秒間に1回を超えない頻度で送信されます。
- キャッシュされたARPエントリは1分後に失効します。
- 802.3 フレーム 802.1Qはサポートされて**いません**。
- ジャンボフレームはサポートされて**いません**。

### IP層

#### IPv4

- IPv4ヘッダのチェックサムが生成・検証されます。
- IPv4 time-to-live値はソケットごとに設定可能で、デフォルト値は64です。
- IPv4デフォルトゲートウェイがサポートされています。
- デフォルトゲートウェイまたはCIDRルートテーブルによるIPv4パケットの
  ルーティングがサポートされています。
- IPv4フラグメンテーションはサポートされて**いません**。
- IPv4オプションはサポートされて**おらず**、無視されます。

#### IPv6

- IPv6のホップリミット値はソケットごとに設定可能で、デフォルト値は64です。
- デフォルトゲートウェイまたはCIDRルートテーブルによるIPv6パケットの
  ルーティングがサポートされています。
- IPv6ホップバイホップヘッダに対応しています。
- 認識できないIPv6ネクストヘッダに対するICMPv6パラメータ問題メッセージは
  生成されます。
- 未知のIPv6ホップバイホップオプションに対するICMPv6パラメータ問題メッセージは
  生成**されません**

#### IPマルチキャスト

##### IGMP

IGMPv1プロトコルとIGMPv2プロトコルがサポートされ、IPv4マルチキャストが
利用できます。

- 最大応答時間をレポートするグループ数で割った値に等しい間隔でメンバシップ
  レポートがメンバシップクエリに対して送信されます。

### ICMP層

#### ICMPv4

ICMPv4プロトコルがサポートされ、ICMPソケットが利用できます。

- ICMPv4ヘッダチェックサムがサポートされています。
- エコー要求に応答してICMPv4エコー応答が生成されます。
- ICMPソケットはICMPv4 Port到達不能メッセージまたは指定されたIPv4識別子
  フィールドを持つすべてのICMPv4メッセージをリッスンできます。
- ICMPv4プロトコル到達不能メッセージを受信しても上位レイヤには**渡されません**。
- ICMPv4パラメータ問題メッセージは生成**されません**。

#### ICMPv6

#### NDISC

### UDP層

### TCP層

TCPプロトコルはIPv4とIPv6でサポートされ、サーバとクライアントのTCPソケットが
利用できます。

- ヘッダーのチェックサムが生成・検証されます。
- 最大セグメントサイズがネゴシエートされます。
- ウィンドウスケーリングがネゴシエートされます。
- 複数のパケットが確認応答を待たずに送信されます。
- シーケンススペースに4または32以上のギャップがない順序の違うセグメントの
  再組み立てがサポートされています。
- キープアライブパケットが設定可能な間隔で送信されます。
- 再送タイムアウトは100msの固定間隔から始まり、毎回2倍になります。
- タイムウェイトタイムアウトは10秒の固定間隔です。
- ユーザタイムアウトの間隔は設定可能です。
- 選択的確認応答は実装されて**いません**。
- 遅延確認応答は実装されて**いません**。
- Silly window syndromeの回避は実装されて**いません**。
- Nagleのアルゴリズムは実装されて**いません**。
- 輻輳制御は実装されて**いません**。
- タイムスタンプはサポートされて**いません**。
- 緊急ポインタは**無視されます**。
- プロービングゼロウィンドウは実装されて**いません**。
- [PLPMTU](https://tools.ietf.org/rfc/rfc4821.txt) (Packetization Layer Path MTU)発見は実装されて**いません**。
